version: 2.1

orbs:
  docker: circleci/docker@2.0.5
  aws-ecr: circleci/aws-ecr@7
  aws-cli: circleci/aws-cli@2
  version: carejourney/versionv2@1
  slack: circleci/slack@4.4.4
  jq: circleci/jq@2
  helm: circleci/helm@1
  kubernetes: circleci/kubernetes@1
  gh: circleci/github-cli@2
  pip: carejourney/pip-config@1
  mem: circleci/rememborb@0.0.2
  yq: carejourney/yq@1
  python: circleci/python@2


  Environment Setup:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - yq/install
      - mem/remember:
          env_var: REPO_VERSION
          value: $(cat config.ini | sed -n 2p | cut -d' ' -f 3)
      - persist_to_workspace:
          name: Save environment
          root: /home/circleci/
          paths:
            - project

# our defined job, and its steps
jobs:
  Environment Setup:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - yq/install
      - mem/remember:
          env_var: REPO_VERSION
          value: $(cat config.ini | sed -n 2p | cut -d' ' -f 3)
      - persist_to_workspace:
          name: Save environment
          root: /home/circleci/
          paths:
            - project

workflows:
  test:
    jobs:
      - Environment Setup