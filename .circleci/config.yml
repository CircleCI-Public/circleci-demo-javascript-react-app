version: 2.1

description: |
  Push git commits to origin using the --atomic option
parameters:
  branch:
    default: development
    description: Name of the branch to push to origin
    type: string
steps:
  - run:
      command: |
        GitPush() {
            git push --tags --atomic --set-upstream origin "${PARAM_BRANCH}"
        }

        # Will not run if sourced for bats-core tests.
        # View src/tests for more information.
        ORB_TEST_ENV="bats-core"
        if [ "${0#*$ORB_TEST_ENV}" == "$0" ]; then
            GitPush
        fi
      environment:
        PARAM_BRANCH: << parameters.branch >>
      name: Push git commit to origin